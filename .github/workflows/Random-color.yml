name: ğŸ¨ Random Capsule Gradient

on:
  push:
    branches: [ main ]          # æ¯æ¬¡æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  schedule:
    - cron: '0 0 * * *'         # æ¯å¤© 00:00 UTC è§¦å‘ä¸€æ¬¡
  workflow_dispatch:            # æ”¯æŒæ‰‹åŠ¨è§¦å‘

permissions:
  contents: write               # æˆäºˆå†™ä»“åº“æƒé™ä»¥æ›´æ–° README

jobs:
  gradient:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3  # æ£€å‡ºä»£ç åº“

      - name: Random pick gradient & update README
        run: |
          # æ¸…æ–°æ·¡é›…çš„é¢œè‰²æ± ï¼ŒéšæœºæŒ‘é€‰ 4 ç§ç»„æˆæ¸å˜
          colors=(
            "A3BFFA"  # æµ…ç´«è“
            "AED9E0"  # æ¹–è“
            "B9E4C9"  # è–„è·ç»¿
            "C1E1C1"  # æ·¡ç»¿
            "D4F1F4"  # æ°´è“
            "E0F7FA"  # æµ…é’
            "F8C8DC"  # æ¨±èŠ±ç²‰
            "F5E1E6"  # æ·¡ç²‰
            "FAD2CF"  # èœœæ¡ƒç²‰
            "E6E6FA"  # è–°è¡£è‰ç´«
            "F0E4D7"  # ç±³ç™½
            "D8D8F0"  # æ·¡ç´«
          )
          # éšæœºæŒ‘é€‰ 4 ä¸ªé¢œè‰²
          selected_colors=($(shuf -n 4 -e "${colors[@]}"))
          color="0:${selected_colors[0]},33:${selected_colors[1]},66:${selected_colors[2]},100:${selected_colors[3]}"

          header_block="<!-- capsulate-header-start -->\n<p align=\"center\">\n  <img src=\"https://capsule-render.vercel.app/api?type=waving&height=200&section=header&fontSize=40&fontAlignY=35&text=ğŸ‘‹%20Hi%2C%20I%27m%20BlueSeagull&desc=Welcome%20to%20my%20GitHub&descAlignY=55&color=${color}\" alt=\"header\"/>\n</p>\n<!-- capsulate-header-end-->"

          footer_block="<!-- capsulate-footer-start -->\n<p align=\"center\">\n  <img src=\"https://capsule-render.vercel.app/api?type=waving&height=100&section=footer&color=${color}\" alt=\"footer\"/>\n</p>\n<!-- capsulate-footer-end-->"

          # ä½¿ç”¨ Perl æ›¿æ¢ README.md ä¸­çš„ header å’Œ footer éƒ¨åˆ†
          perl -0777 -pe "
            s|<!-- capsulate-header-start -->.*?<!-- capsulate-header-end-->|$header_block|s;
            s|<!-- capsulate-footer-start -->.*?<!-- capsulate-footer-end-->|$footer_block|s;
          " -i README.md

          # è°ƒè¯•ï¼šè¾“å‡ºç”Ÿæˆçš„é¢œè‰²å€¼
          echo "Generated color: $color"

      - name: Commit & push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (
            git commit -m "ğŸ¨ chore: update capsule gradient"
            git push
          )
