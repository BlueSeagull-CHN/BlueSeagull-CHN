name: ğŸ¨ Random Capsule Gradient

on:
  push:
    branches: [ main ]          # æ¯æ¬¡æ¨é€è‡ªåŠ¨æ¢è‰²
  schedule:
    - cron: '0 0 * * *'         # æ¯å¤© 00:00 UTC å…œåº•æ¢ä¸€æ¬¡
  workflow_dispatch:            # æ‰‹åŠ¨ Run workflow æŒ‰é’®

permissions:
  contents: write               # å…³é”®ï¼šæˆäºˆå†™ä»“åº“æƒé™

jobs:
  gradient:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Random pick gradient & update README
        run: |
          # é…è‰²æ± ï¼Œæƒ³åŠ æ–°æ¸å˜ç»§ç»­å¾€æ•°ç»„é‡Œå†™
          gradients=(
            "0,FF6B6B,FFD479,FFFC79,73FA79"
            "0,4158D0,FFCC70,FFD479,74B9FF"
            "0,667EEA,764BA2,F093FB,F5576C"
          )
          color=${gradients[$(shuf -i 0-$((${#gradients[@]}-1)) -n 1)]}

          header_block="<!-- capsulate-header-start -->\n<p align=\"center\">\n  <img src=\"https://capsule-render.vercel.app/api?type=waving&height=200&section=header&fontSize=40&fontAlignY=35&text=ğŸ‘‹%20Hi%2C%20I%27m%20BlueSeagull&desc=Welcome%20to%20my%20GitHub&descAlignY=55&color=${color}\" alt=\"header\"/>\n</p>\n<!-- capsulate-header-end-->"

          footer_block="<!-- capsulate-footer-start -->\n<p align=\"center\">\n  <img src=\"https://capsule-render.vercel.app/api?type=waving&height=100&section=footer&color=${color}\" alt=\"footer\"/>\n</p>\n<!-- capsulate-footer-end-->"

          # æ›¿æ¢ README
          perl -0777 -pe "
            s|<!-- capsulate-header-start -->.*?<!-- capsulate-header-end-->|$header_block|s;
            s|<!-- capsulate-footer-start -->.*?<!-- capsulate-footer-end-->|$footer_block|s;
          " -i README.md

      - name: Commit & push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (
            git commit -m "ğŸ¨ chore: update capsule gradient"
            git push
          )
